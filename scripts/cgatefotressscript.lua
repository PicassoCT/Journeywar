

include "lib_OS.lua"
include "lib_UnitScript.lua"
include "lib_Build.lua" 

  TableOfPieces={}
  center = piece("center")
 TableOfPieces[#TableOfPieces+1]= center
  Erker4 = piece("Erker4")
 TableOfPieces[#TableOfPieces+1]= Erker4
  InnerLoop0 = piece("InnerLoop0")
 TableOfPieces[#TableOfPieces+1]= InnerLoop0
  InnerLoop1 = piece("InnerLoop1")
 TableOfPieces[#TableOfPieces+1]= InnerLoop1
  InnerLoop2 = piece("InnerLoop2")
 TableOfPieces[#TableOfPieces+1]= InnerLoop2
  InnerLoop3 = piece("InnerLoop3")
 TableOfPieces[#TableOfPieces+1]= InnerLoop3
  InnerLoop4 = piece("InnerLoop4")
 TableOfPieces[#TableOfPieces+1]= InnerLoop4
  InnerLoop5 = piece("InnerLoop5")
 TableOfPieces[#TableOfPieces+1]= InnerLoop5
  InnerLoop6 = piece("InnerLoop6")
 TableOfPieces[#TableOfPieces+1]= InnerLoop6
  InnerLoop7 = piece("InnerLoop7")
 TableOfPieces[#TableOfPieces+1]= InnerLoop7
  InnerLoop8 = piece("InnerLoop8")
 TableOfPieces[#TableOfPieces+1]= InnerLoop8
  InnerLoop9 = piece("InnerLoop9")
 TableOfPieces[#TableOfPieces+1]= InnerLoop9
  InnerLoopC = piece("InnerLoopC")
 TableOfPieces[#TableOfPieces+1]= InnerLoopC
  NGon085 = piece("NGon085")
 TableOfPieces[#TableOfPieces+1]= NGon085
  NGon086 = piece("NGon086")
 TableOfPieces[#TableOfPieces+1]= NGon086
  NGon089 = piece("NGon089")
 TableOfPieces[#TableOfPieces+1]= NGon089
  NGon090 = piece("NGon090")
 TableOfPieces[#TableOfPieces+1]= NGon090
  NGon088 = piece("NGon088")
 TableOfPieces[#TableOfPieces+1]= NGon088
  Gun3 = piece("Gun3")
 TableOfPieces[#TableOfPieces+1]= Gun3
  Mag5 = piece("Mag5")
 TableOfPieces[#TableOfPieces+1]= Mag5
  Mag6 = piece("Mag6")
 TableOfPieces[#TableOfPieces+1]= Mag6
  Erker3 = piece("Erker3")
 TableOfPieces[#TableOfPieces+1]= Erker3
  Erker2 = piece("Erker2")
 TableOfPieces[#TableOfPieces+1]= Erker2
  NGon087 = piece("NGon087")
 TableOfPieces[#TableOfPieces+1]= NGon087
  InnerOrigin = piece("InnerOrigin")
 TableOfPieces[#TableOfPieces+1]= InnerOrigin
  OuterLoo12 = piece("OuterLoo12")
 TableOfPieces[#TableOfPieces+1]= OuterLoo12
  OuterLoo24 = piece("OuterLoo24")
 TableOfPieces[#TableOfPieces+1]= OuterLoo24
  OuterLoo27 = piece("OuterLoo27")
 TableOfPieces[#TableOfPieces+1]= OuterLoo27
  Gun1 = piece("Gun1")
 TableOfPieces[#TableOfPieces+1]= Gun1
  Mag1 = piece("Mag1")
 TableOfPieces[#TableOfPieces+1]= Mag1
  Mag2 = piece("Mag2")
 TableOfPieces[#TableOfPieces+1]= Mag2
  OuterLoo25 = piece("OuterLoo25")
 TableOfPieces[#TableOfPieces+1]= OuterLoo25
  OuterLoo29 = piece("OuterLoo29")
 TableOfPieces[#TableOfPieces+1]= OuterLoo29
  Gun4 = piece("Gun4")
 TableOfPieces[#TableOfPieces+1]= Gun4
  Mag7 = piece("Mag7")
 TableOfPieces[#TableOfPieces+1]= Mag7
  Mag8 = piece("Mag8")
 TableOfPieces[#TableOfPieces+1]= Mag8
  OuterLoo30 = piece("OuterLoo30")
 TableOfPieces[#TableOfPieces+1]= OuterLoo30
  OuterLoo31 = piece("OuterLoo31")
 TableOfPieces[#TableOfPieces+1]= OuterLoo31
  OuterLoo32 = piece("OuterLoo32")
 TableOfPieces[#TableOfPieces+1]= OuterLoo32
  OuterLoo35 = piece("OuterLoo35")
 TableOfPieces[#TableOfPieces+1]= OuterLoo35
  OuterLoo36 = piece("OuterLoo36")
 TableOfPieces[#TableOfPieces+1]= OuterLoo36
  OuterLoo37 = piece("OuterLoo37")
 TableOfPieces[#TableOfPieces+1]= OuterLoo37
  OuterLoo38 = piece("OuterLoo38")
 TableOfPieces[#TableOfPieces+1]= OuterLoo38
  OuterLoo39 = piece("OuterLoo39")
 TableOfPieces[#TableOfPieces+1]= OuterLoo39
  Erker5 = piece("Erker5")
 TableOfPieces[#TableOfPieces+1]= Erker5
  Erker6 = piece("Erker6")
 TableOfPieces[#TableOfPieces+1]= Erker6
  OuterLoo34 = piece("OuterLoo34")
 TableOfPieces[#TableOfPieces+1]= OuterLoo34
  OuterLoo40 = piece("OuterLoo40")
 TableOfPieces[#TableOfPieces+1]= OuterLoo40
  OuterLoo41 = piece("OuterLoo41")
 TableOfPieces[#TableOfPieces+1]= OuterLoo41
  OuterLoo43 = piece("OuterLoo43")
 TableOfPieces[#TableOfPieces+1]= OuterLoo43
  RailGun = piece("RailGun")
 TableOfPieces[#TableOfPieces+1]= RailGun
  Projectile = piece("Projectile")
 TableOfPieces[#TableOfPieces+1]= Projectile
  DronePod1 = piece("DronePod1")
 TableOfPieces[#TableOfPieces+1]= DronePod1
  DronePod2 = piece("DronePod2")
 TableOfPieces[#TableOfPieces+1]= DronePod2
  OuterLoo33 = piece("OuterLoo33")
 TableOfPieces[#TableOfPieces+1]= OuterLoo33
  OuterLoo42 = piece("OuterLoo42")
 TableOfPieces[#TableOfPieces+1]= OuterLoo42
  OuterLoo44 = piece("OuterLoo44")
 TableOfPieces[#TableOfPieces+1]= OuterLoo44
  OuterLoo47 = piece("OuterLoo47")
 TableOfPieces[#TableOfPieces+1]= OuterLoo47
  OuterLoo55 = piece("OuterLoo55")
 TableOfPieces[#TableOfPieces+1]= OuterLoo55
  Erker9 = piece("Erker9")
 TableOfPieces[#TableOfPieces+1]= Erker9
  Erker10 = piece("Erker10")
 TableOfPieces[#TableOfPieces+1]= Erker10
  OuterLoo54 = piece("OuterLoo54")
 TableOfPieces[#TableOfPieces+1]= OuterLoo54
  DronePod3 = piece("DronePod3")
 TableOfPieces[#TableOfPieces+1]= DronePod3
  Erker11 = piece("Erker11")
 TableOfPieces[#TableOfPieces+1]= Erker11
  OuterLoo50 = piece("OuterLoo50")
 TableOfPieces[#TableOfPieces+1]= OuterLoo50
  OuterLoo51 = piece("OuterLoo51")
 TableOfPieces[#TableOfPieces+1]= OuterLoo51
  DronePod4 = piece("DronePod4")
 TableOfPieces[#TableOfPieces+1]= DronePod4
  OuterLoo45 = piece("OuterLoo45")
 TableOfPieces[#TableOfPieces+1]= OuterLoo45
  OuterLoo46 = piece("OuterLoo46")
 TableOfPieces[#TableOfPieces+1]= OuterLoo46
  OuterLoo53 = piece("OuterLoo53")
 TableOfPieces[#TableOfPieces+1]= OuterLoo53
  OuterLoo52 = piece("OuterLoo52")
 TableOfPieces[#TableOfPieces+1]= OuterLoo52
  Erker1 = piece("Erker1")
 TableOfPieces[#TableOfPieces+1]= Erker1
  Erker8 = piece("Erker8")
 TableOfPieces[#TableOfPieces+1]= Erker8
  OuterLoo48 = piece("OuterLoo48")
 TableOfPieces[#TableOfPieces+1]= OuterLoo48
  OuterLoo49 = piece("OuterLoo49")
 TableOfPieces[#TableOfPieces+1]= OuterLoo49
  Erker7 = piece("Erker7")
 TableOfPieces[#TableOfPieces+1]= Erker7
  DronePod5 = piece("DronePod5")
 TableOfPieces[#TableOfPieces+1]= DronePod5
  Wall = piece("Wall")
 TableOfPieces[#TableOfPieces+1]= Wall
  GatePoint = piece("GatePoint")
 TableOfPieces[#TableOfPieces+1]= GatePoint
  RingB = piece("RingB")
 TableOfPieces[#TableOfPieces+1]= RingB
  Ring0 = piece("Ring0")
 TableOfPieces[#TableOfPieces+1]= Ring0
  GatePortal = piece("GatePortal")
 TableOfPieces[#TableOfPieces+1]= GatePortal
  GateWave = piece("GateWave")
 TableOfPieces[#TableOfPieces+1]= GateWave
  WaveA = piece("WaveA")
 TableOfPieces[#TableOfPieces+1]= WaveA
  Feed11 = piece("Feed11")
 TableOfPieces[#TableOfPieces+1]= Feed11
  Feed10 = piece("Feed10")
 TableOfPieces[#TableOfPieces+1]= Feed10
  Feed8 = piece("Feed8")
 TableOfPieces[#TableOfPieces+1]= Feed8
  Feed7 = piece("Feed7")
 TableOfPieces[#TableOfPieces+1]= Feed7
  Feed6 = piece("Feed6")
 TableOfPieces[#TableOfPieces+1]= Feed6
  Feed5 = piece("Feed5")
 TableOfPieces[#TableOfPieces+1]= Feed5
  Feed4 = piece("Feed4")
 TableOfPieces[#TableOfPieces+1]= Feed4
  Feed3 = piece("Feed3")
 TableOfPieces[#TableOfPieces+1]= Feed3
  Feed2 = piece("Feed2")
 TableOfPieces[#TableOfPieces+1]= Feed2
  Feed1 = piece("Feed1")
 TableOfPieces[#TableOfPieces+1]= Feed1
  Ring3 = piece("Ring3")
 TableOfPieces[#TableOfPieces+1]= Ring3
  Ring2 = piece("Ring2")
 TableOfPieces[#TableOfPieces+1]= Ring2
  Ring1 = piece("Ring1")
 TableOfPieces[#TableOfPieces+1]= Ring1
  BigLUpCenter = piece("BigLUpCenter")
 TableOfPieces[#TableOfPieces+1]= BigLUpCenter
  OuterLoo13 = piece("OuterLoo13")
 TableOfPieces[#TableOfPieces+1]= OuterLoo13
  OuterLoo14 = piece("OuterLoo14")
 TableOfPieces[#TableOfPieces+1]= OuterLoo14
  OuterLoo15 = piece("OuterLoo15")
 TableOfPieces[#TableOfPieces+1]= OuterLoo15
  OuterLoo16 = piece("OuterLoo16")
 TableOfPieces[#TableOfPieces+1]= OuterLoo16
  OuterLoo17 = piece("OuterLoo17")
 TableOfPieces[#TableOfPieces+1]= OuterLoo17
  OuterLoo18 = piece("OuterLoo18")
 TableOfPieces[#TableOfPieces+1]= OuterLoo18
  OuterLoo19 = piece("OuterLoo19")
 TableOfPieces[#TableOfPieces+1]= OuterLoo19
  OuterLoo20 = piece("OuterLoo20")
 TableOfPieces[#TableOfPieces+1]= OuterLoo20
  OuterLoo21 = piece("OuterLoo21")
 TableOfPieces[#TableOfPieces+1]= OuterLoo21
  OuterLoo22 = piece("OuterLoo22")
 TableOfPieces[#TableOfPieces+1]= OuterLoo22
  OuterLoo23 = piece("OuterLoo23")
 TableOfPieces[#TableOfPieces+1]= OuterLoo23
  OuterLoo56 = piece("OuterLoo56")
 TableOfPieces[#TableOfPieces+1]= OuterLoo56
  BigLCenter = piece("BigLCenter")
 TableOfPieces[#TableOfPieces+1]= BigLCenter
  OuterLoo10 = piece("OuterLoo10")
 TableOfPieces[#TableOfPieces+1]= OuterLoo10
  OuterLoo11 = piece("OuterLoo11")
 TableOfPieces[#TableOfPieces+1]= OuterLoo11
  OuterLoop0 = piece("OuterLoop0")
 TableOfPieces[#TableOfPieces+1]= OuterLoop0
  OuterLoop1 = piece("OuterLoop1")
 TableOfPieces[#TableOfPieces+1]= OuterLoop1
  OuterLoo26 = piece("OuterLoo26")
 TableOfPieces[#TableOfPieces+1]= OuterLoo26
  OuterLoo28 = piece("OuterLoo28")
 TableOfPieces[#TableOfPieces+1]= OuterLoo28
  Gun2 = piece("Gun2")
 TableOfPieces[#TableOfPieces+1]= Gun2
  Mag3 = piece("Mag3")
 TableOfPieces[#TableOfPieces+1]= Mag3
  Mag4 = piece("Mag4")
 TableOfPieces[#TableOfPieces+1]= Mag4
  OuterLoop2 = piece("OuterLoop2")
 TableOfPieces[#TableOfPieces+1]= OuterLoop2
  OuterLoop3 = piece("OuterLoop3")
 TableOfPieces[#TableOfPieces+1]= OuterLoop3
  OuterLoop4 = piece("OuterLoop4")
 TableOfPieces[#TableOfPieces+1]= OuterLoop4
  OuterLoop5 = piece("OuterLoop5")
 TableOfPieces[#TableOfPieces+1]= OuterLoop5
  OuterLoop6 = piece("OuterLoop6")
 TableOfPieces[#TableOfPieces+1]= OuterLoop6
  OuterLoop7 = piece("OuterLoop7")
 TableOfPieces[#TableOfPieces+1]= OuterLoop7
  OuterLoop8 = piece("OuterLoop8")
 TableOfPieces[#TableOfPieces+1]= OuterLoop8
  OuterLoop9 = piece("OuterLoop9")
 TableOfPieces[#TableOfPieces+1]= OuterLoop9
  CatapultRoto1 = piece("CatapultRoto1")
 TableOfPieces[#TableOfPieces+1]= CatapultRoto1
  CataLow1 = piece("CataLow1")
 TableOfPieces[#TableOfPieces+1]= CataLow1
  CataUp1 = piece("CataUp1")
 TableOfPieces[#TableOfPieces+1]= CataUp1
  CataHead1 = piece("CataHead1")
 TableOfPieces[#TableOfPieces+1]= CataHead1
  CatapultRoto2 = piece("CatapultRoto2")
 TableOfPieces[#TableOfPieces+1]= CatapultRoto2
  CataLow2 = piece("CataLow2")
 TableOfPieces[#TableOfPieces+1]= CataLow2
  CataUp2 = piece("CataUp2")
 TableOfPieces[#TableOfPieces+1]= CataUp2
  CataHead2 = piece("CataHead2")
 TableOfPieces[#TableOfPieces+1]= CataHead2


TablesOfPiecesGroups={}--=makePiecesTablesByNameGroups(false,true)

FeedTable={}
OuterLoopTable={}
OuterLooTable={}
Mag={}
Ring={}

function script.HitByWeapon ( x, z, weaponDefID, damage ) 

end

function script.Create()
TablesOfPiecesGroups=makePiecesTablesByNameGroups(false,true)
FeedTable=TablesOfPiecesGroups["Feed"]
OuterLoopTable=TablesOfPiecesGroups["OuterLoop"]
OuterLooTable=TablesOfPiecesGroups["OuterLoo"]
Mag=TablesOfPiecesGroups["Mag"]
Ring=TablesOfPiecesGroups["Ring"]


	for i=1,#Mag do
	Sign=i%2
	if Sign==0 then Sign=-1 end
		Spin(Mag[i],x_axis,math.rad(42*Sign),0)
	end
x,y,z=Spring.GetUnitPiecePosDir(unitID,RingB)

hideT(TableOfPieces)
--generatepiecesTableAndArrayCode(unitID)
StartThread(AnimTest)
end

function script.Killed(recentDamage,_)
	return 1
end


----aimining & fire weapon
function script.AimFromWeapon1() 
	return center 
end



function script.QueryWeapon1() 
	return center
end

function script.AimWeapon1( Heading ,pitch)	
	--aiming animation: instantly turn the gun towards the enemy

	return boolOneShot

end

function AnimTest()
	while true do 
		unfoldAnimation()
		Sleep(1000)
		foldAnimation()
	end

end
 
 local SignalTable={}
function unfoldAnimation()
Sleep(10)
Spring.Echo("UnfoldAnimation")
n=1
n=	GateDeploy(n,true)	
	StartThread(GateLoop,n,true)
while true do
Sleep(100)
end
n=	FirstTrainDeploy(n,true)	
	StartThread(TrainLoop,n,true)

n=	InnerCircleDeploy(n,true)	
	StartThread(InnerCircleLoop,n,true)

n=	OuterCircleDeploy(n,true)	
	StartThread(OuterCircleLoop,n,true)

n=	UpperCircleDeploy(n,true)
n=	TowerDeploy(n,true)
n=	OutPostDeploy(n,true)
n=	InnerCityDeploy(n,true)
n=	RailGunUnfold(n,true)
n=	CityBlocksDeploy(n,true)	



end

function foldAnimation()
Sleep(10)
Spring.Echo("Fold Animation")
testPiece=piece("center")
Spring.Echo(testPiece)
--	CityBlocksDeploy	
--	RailGunUnfold
--	InnerCityDeploy
--	OutPostDeploy
--	TowerDeploy
--	UpperCircleDeploy

--OuterCircleLoop
	--OuterCircleDeploy
--InnerCircleLoop
	--InnerCircleDeploy
--GateLoop
	--GateDeploy
--TrainLoop
	--FirstTrainDeploy
	

hideT(TableOfPieces)
end

boolOnTheMove=false 
boolOneShot=true 
teamid=Spring.GetUnitTeam(unitID)

function script.FireWeapon1()	
boolOneShot=false
makeCascadingTables("GG.FiringGateFotressTable["..teamid.."["..unitID.."",true)
StartThread(watchForImpact)
	return true
end

function GateDeploy (SignalNumber,boolReverse) 
	boolDirection= false 
	if boolReverse then boolDirection =boolReverse end
	--if the animation should be aborted, we revert it 
	if SignalTable[SignalNumber]==false then boolDirection=true end
		if boolDirection==true then
		--Preparation
		Move(center,y_axis,2.5,0)
		Move(Ring0,y_axis,-15,0)
		Turn(Ring0,y_axis,math.rad(-90),0)
		Show(Ring0)
		Show(RingB)
		Turn(Ring0,y_axis,math.rad(0),1.2)
		moveExpPiece(Ring0,y_axis,15,-15,
					5,750,15,false)
		Move(Ring0,y_axis,0,35)
		WaitForMove(Ring0,y_axis)
		Turn(Ring3,x_axis,math.rad(180+46),0)
		Turn(Ring2,x_axis,math.rad(180+2*46),0)
		Turn(Ring1,x_axis,math.rad(180+3*46),0)
		WaitForTurn(Ring3,x_axis)
		WaitForTurn(Ring2,x_axis)
		WaitForTurn(Ring1,x_axis)
		Turn(Ring1,x_axis,math.rad(0),10)				
		Show(Ring1)
		WaitForTurn(Ring1,x_axis)
		Turn(Ring2,x_axis,math.rad(0),10)
		Show(Ring2)
		WaitForTurn(Ring2,x_axis)
		Turn(Ring3,x_axis,math.rad(0),10)
		Show(Ring3)
		WaitForTurn(Ring3,x_axis)
		Show(GatePortal)
		Spin(GatePortal,x_axis,math.rad(42),0)
		
		
		
		else


		 
		end 
	return SignalNumber+1 
 end
 
function GateLoop (SignalNumber,boolReverse) 
AlterRate=0
SignalTable[SignalNumber]=true
	while SignalTable[SignalNumber]==true do
AlterRate=AlterRate+1
				Spin(GateWave,x_axis,math.rad(42),0)
				Spin(WaveA,x_axis,math.rad(42),0)
				Show(GateWave)
				Show(WaveA)
				speed=math.random(1.5,4)
				if maRo() then
					
					if AlterRate % 2==1 then
						Move(GateWave,x_axis,-5.5,speed)
					end
					
					if AlterRate % 2==0 then
						Move(WaveA,x_axis,-3.14,speed)
					end
				end
				
				
				WaitForMove(WaveA,x_axis)
				WaitForMove(GateWave,x_axis)
				Move(WaveA,x_axis,0,speed)
				Move(GateWave,x_axis,0,speed)
				WaitForMove(WaveA,x_axis)
				WaitForMove(GateWave,x_axis)
				
		
	Sleep(10)
	end
--HoldPosition
return SignalNumber+1 
 end
 
function FirstTrainDeploy (SignalNumber,boolReverse) 
 	boolDirection= false 
	if boolReverse then boolDirection =boolReverse end
	--if the animation should be aborted, we revert it 
	if SignalTable[SignalNumber]==false then boolDirection=true end

		if boolDirection==true then

		else


		 
		end 
 return SignalNumber+1 
 end
	function TrainLoop (SignalNumber,boolReverse) 
 
 return SignalNumber+1 
 end
function InnerCircleDeploy (SignalNumber,boolReverse) 
 
 return SignalNumber+1 
 end
	function InnerCircleLoop (SignalNumber,boolReverse) 
 
 return SignalNumber+1 
 end
function OuterCircleDeploy (SignalNumber,boolReverse) 
 
 return SignalNumber+1 
 end
	function OuterCircleLoop (SignalNumber,boolReverse) 
 
 return SignalNumber+1 
 end
function 	UpperCircleDeploy(SignalNumber,boolReverse) 
 
 return SignalNumber+1 
 end
function 	TowerDeploy(SignalNumber,boolReverse) 
 
 return SignalNumber+1 
 end
function 	OutPostDeploy(SignalNumber,boolReverse) 
 
 return SignalNumber+1 
 end
function 	InnerCityDeploy(SignalNumber,boolReverse) 
 
 return SignalNumber+1 
 end
function 	RailGunUnfold(SignalNumber,boolReverse) 
 
 return SignalNumber+1 
 end
function 	CityBlocksDeploy	(SignalNumber,boolReverse) 
 
 return SignalNumber+1 
 end

function watchForImpact()
	while GG.FiringGateFotressTable[teamid][unitID]==true do
	Sleep(250)
	end
boolOnTheMove=true
foldAnimation()	
Spring.DstroyUnit(unitID,true,false)
end



function script.Activate()

return 1
end

function script.Deactivate()

return 0
end



